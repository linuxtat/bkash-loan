<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>‡¶≤‡ßã‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f5;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      max-width: 300px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: right;
    }
    th {
      background: #ddd;
    }
    tfoot td {
      font-weight: bold;
      background: #eef;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 750px;
      margin: auto;
    }
    .summary {
      margin-top: 20px;
      background: #fff5e6;
      padding: 15px;
      border-radius: 8px;
    }
    .summary p {
      margin: 5px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä ‡¶≤‡ßã‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h1>

    <label>‡¶≤‡ßã‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥):</label><br>
    <input type="number" id="amount" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 100000"><br>

    <label>‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶´‡¶ø (%):</label><br>
    <input type="number" id="processingFee" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 1.5"><br>

    <label>‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (‡¶¨‡¶æ‡ßé‡¶∏‡¶∞‡¶ø‡¶ï %):</label><br>
    <input type="number" id="rate" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 12"><br>

    <label>‡¶∏‡¶Æ‡¶Ø‡¶º (‡¶Æ‡¶æ‡¶∏‡ßá):</label><br>
    <input type="number" id="months" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 12"><br>

    <button onclick="calculateEMI()">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®</button>

    <div class="summary" id="loanSummary" style="display:none;">
      <h3>üìå ‡¶≤‡ßã‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
      <p id="netAmountResult"></p>
      <p id="emiResult"></p>
      <p id="totalPrincipalLine"></p>
      <p id="totalInterestLine"></p>
      <p id="totalPaymentLine"></p>
      <button onclick="downloadPDF()">üì• PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <table id="scheduleTable" style="display:none;">
      <thead>
        <tr>
          <th>‡¶Æ‡¶æ‡¶∏</th>
          <th>‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® (‡ß≥)</th>
          <th>‡¶∏‡ßÅ‡¶¶ (‡ß≥)</th>
          <th>‡¶Æ‡ßã‡¶ü ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø (‡ß≥)</th>
          <th>‡¶¨‡¶æ‡¶ï‡¶ø ‡¶ã‡¶£ (‡ß≥)</th>
        </tr>
      </thead>
      <tbody id="scheduleBody"></tbody>
      <tfoot>
        <tr>
          <td>‡¶Æ‡ßã‡¶ü</td>
          <td id="totalPrincipal">0.00</td>
          <td id="totalInterest">0.00</td>
          <td id="totalPayment">0.00</td>
          <td>‚Äî</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <script>
    function calculateEMI() {
      const amount = parseFloat(document.getElementById("amount").value);
      const processingFeePercent = parseFloat(document.getElementById("processingFee").value) || 0;
      const annualRate = parseFloat(document.getElementById("rate").value);
      const months = parseInt(document.getElementById("months").value);

      const processingFee = amount * (processingFeePercent / 100);
      const netAmount = amount - processingFee;
      const monthlyRate = annualRate / 12 / 100;
      const emi = amount * monthlyRate * Math.pow(1 + monthlyRate, months) / (Math.pow(1 + monthlyRate, months) - 1);

      let balance = amount;
      let totalPrincipal = 0;
      let totalInterest = 0;
      const tableBody = document.getElementById("scheduleBody");
      tableBody.innerHTML = "";

      for (let i = 1; i <= months; i++) {
        const interest = balance * monthlyRate;
        const principal = emi - interest;
        balance -= principal;

        totalPrincipal += principal;
        totalInterest += interest;

        const row = `<tr>
          <td>${i}</td>
          <td>${principal.toFixed(2)}</td>
          <td>${interest.toFixed(2)}</td>
          <td>${emi.toFixed(2)}</td>
          <td>${balance > 0 ? balance.toFixed(2) : "0.00"}</td>
        </tr>`;
        tableBody.innerHTML += row;
      }

      const totalPayment = totalPrincipal + totalInterest;

      // Show summary
      document.getElementById("netAmountResult").innerText = `‡¶π‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®: ‡ß≥${netAmount.toFixed(2)} (‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶´‡¶ø ‡¶ï‡ßá‡¶ü‡ßá)`;
      document.getElementById("emiResult").innerText = `‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø: ‡ß≥${emi.toFixed(2)}`;
      document.getElementById("totalPrincipalLine").innerText = `‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß: ‡ß≥${totalPrincipal.toFixed(2)}`;
      document.getElementById("totalInterestLine").innerText = `‡¶Æ‡ßã‡¶ü ‡¶∏‡ßÅ‡¶¶ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß: ‡ß≥${totalInterest.toFixed(2)}`;
      document.getElementById("totalPaymentLine").innerText = `‡¶Æ‡ßã‡¶ü ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß: ‡ß≥${totalPayment.toFixed(2)}`;

      document.getElementById("totalPrincipal").innerText = totalPrincipal.toFixed(2);
      document.getElementById("totalInterest").innerText = totalInterest.toFixed(2);
      document.getElementById("totalPayment").innerText = totalPayment.toFixed(2);

      document.getElementById("scheduleTable").style.display = "table";
      document.getElementById("loanSummary").style.display = "block";
    }

    function downloadPDF() {
      const element = document.getElementById("loanSummary");
      const opt = {
        margin:       0.5,
        filename:     'loan-summary.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>
